{"ast":null,"code":"import { __extends } from 'tslib';\nimport Observable from 'zen-observable';\nimport 'symbol-observable';\nimport { iterateObserversSafely } from './iteration.js';\n\nfunction isPromiseLike(value) {\n  return value && typeof value.then === \"function\";\n}\n\nvar Concast = function (_super) {\n  __extends(Concast, _super);\n\n  function Concast(sources) {\n    var _this = _super.call(this, function (observer) {\n      _this.addObserver(observer);\n\n      return function () {\n        return _this.removeObserver(observer);\n      };\n    }) || this;\n\n    _this.observers = new Set();\n    _this.promise = new Promise(function (resolve, reject) {\n      _this.resolve = resolve;\n      _this.reject = reject;\n    });\n    _this.handlers = {\n      next: function (result) {\n        if (_this.sub !== null) {\n          _this.latest = [\"next\", result];\n          iterateObserversSafely(_this.observers, \"next\", result);\n        }\n      },\n      error: function (error) {\n        if (_this.sub !== null) {\n          if (_this.sub) _this.sub.unsubscribe();\n          _this.sub = null;\n          _this.latest = [\"error\", error];\n\n          _this.reject(error);\n\n          iterateObserversSafely(_this.observers, \"error\", error);\n        }\n      },\n      complete: function () {\n        if (_this.sub !== null) {\n          var value = _this.sources.shift();\n\n          if (!value) {\n            _this.sub = null;\n\n            if (_this.latest && _this.latest[0] === \"next\") {\n              _this.resolve(_this.latest[1]);\n            } else {\n              _this.resolve();\n            }\n\n            iterateObserversSafely(_this.observers, \"complete\");\n          } else if (isPromiseLike(value)) {\n            value.then(function (obs) {\n              return _this.sub = obs.subscribe(_this.handlers);\n            });\n          } else {\n            _this.sub = value.subscribe(_this.handlers);\n          }\n        }\n      }\n    };\n\n    _this.cancel = function (reason) {\n      _this.reject(reason);\n\n      _this.sources = [];\n\n      _this.handlers.complete();\n    };\n\n    _this.promise.catch(function (_) {});\n\n    if (isPromiseLike(sources)) {\n      sources.then(function (iterable) {\n        return _this.start(iterable);\n      }, _this.handlers.error);\n    } else {\n      _this.start(sources);\n    }\n\n    return _this;\n  }\n\n  Concast.prototype.start = function (sources) {\n    if (this.sub !== void 0) return;\n    this.sources = Array.from(sources);\n    this.handlers.complete();\n  };\n\n  Concast.prototype.addObserver = function (observer) {\n    if (!this.observers.has(observer)) {\n      if (this.latest) {\n        var nextOrError = this.latest[0];\n        var method = observer[nextOrError];\n\n        if (method) {\n          method.call(observer, this.latest[1]);\n        }\n\n        if (this.sub === null && nextOrError === \"next\" && observer.complete) {\n          observer.complete();\n        }\n      }\n\n      this.observers.add(observer);\n    }\n  };\n\n  Concast.prototype.removeObserver = function (observer, quietly) {\n    if (this.observers.delete(observer) && this.observers.size < 1) {\n      if (quietly) return;\n\n      if (this.sub) {\n        this.sub.unsubscribe();\n        this.reject(new Error(\"Observable cancelled prematurely\"));\n      }\n\n      this.sub = null;\n    }\n  };\n\n  Concast.prototype.cleanup = function (callback) {\n    var _this = this;\n\n    var called = false;\n\n    var once = function () {\n      if (!called) {\n        called = true;\n\n        _this.observers.delete(observer);\n\n        callback();\n      }\n    };\n\n    var observer = {\n      next: once,\n      error: once,\n      complete: once\n    };\n    this.addObserver(observer);\n  };\n\n  return Concast;\n}(Observable);\n\nif (typeof Symbol === \"function\" && Symbol.species) {\n  Object.defineProperty(Concast, Symbol.species, {\n    value: Observable\n  });\n}\n\nexport { Concast };","map":{"version":3,"sources":["Concast.js"],"names":[],"mappings":"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","sourcesContent":["import { __extends } from \"tslib\";\nimport { Observable } from \"./Observable\";\nimport { iterateObserversSafely } from \"./iteration\";\nfunction isPromiseLike(value) {\n    return value && typeof value.then === \"function\";\n}\nvar Concast = (function (_super) {\n    __extends(Concast, _super);\n    function Concast(sources) {\n        var _this = _super.call(this, function (observer) {\n            _this.addObserver(observer);\n            return function () { return _this.removeObserver(observer); };\n        }) || this;\n        _this.observers = new Set();\n        _this.promise = new Promise(function (resolve, reject) {\n            _this.resolve = resolve;\n            _this.reject = reject;\n        });\n        _this.handlers = {\n            next: function (result) {\n                if (_this.sub !== null) {\n                    _this.latest = [\"next\", result];\n                    iterateObserversSafely(_this.observers, \"next\", result);\n                }\n            },\n            error: function (error) {\n                if (_this.sub !== null) {\n                    if (_this.sub)\n                        _this.sub.unsubscribe();\n                    _this.sub = null;\n                    _this.latest = [\"error\", error];\n                    _this.reject(error);\n                    iterateObserversSafely(_this.observers, \"error\", error);\n                }\n            },\n            complete: function () {\n                if (_this.sub !== null) {\n                    var value = _this.sources.shift();\n                    if (!value) {\n                        _this.sub = null;\n                        if (_this.latest &&\n                            _this.latest[0] === \"next\") {\n                            _this.resolve(_this.latest[1]);\n                        }\n                        else {\n                            _this.resolve();\n                        }\n                        iterateObserversSafely(_this.observers, \"complete\");\n                    }\n                    else if (isPromiseLike(value)) {\n                        value.then(function (obs) { return _this.sub = obs.subscribe(_this.handlers); });\n                    }\n                    else {\n                        _this.sub = value.subscribe(_this.handlers);\n                    }\n                }\n            },\n        };\n        _this.cancel = function (reason) {\n            _this.reject(reason);\n            _this.sources = [];\n            _this.handlers.complete();\n        };\n        _this.promise.catch(function (_) { });\n        if (isPromiseLike(sources)) {\n            sources.then(function (iterable) { return _this.start(iterable); }, _this.handlers.error);\n        }\n        else {\n            _this.start(sources);\n        }\n        return _this;\n    }\n    Concast.prototype.start = function (sources) {\n        if (this.sub !== void 0)\n            return;\n        this.sources = Array.from(sources);\n        this.handlers.complete();\n    };\n    Concast.prototype.addObserver = function (observer) {\n        if (!this.observers.has(observer)) {\n            if (this.latest) {\n                var nextOrError = this.latest[0];\n                var method = observer[nextOrError];\n                if (method) {\n                    method.call(observer, this.latest[1]);\n                }\n                if (this.sub === null &&\n                    nextOrError === \"next\" &&\n                    observer.complete) {\n                    observer.complete();\n                }\n            }\n            this.observers.add(observer);\n        }\n    };\n    Concast.prototype.removeObserver = function (observer, quietly) {\n        if (this.observers.delete(observer) &&\n            this.observers.size < 1) {\n            if (quietly)\n                return;\n            if (this.sub) {\n                this.sub.unsubscribe();\n                this.reject(new Error(\"Observable cancelled prematurely\"));\n            }\n            this.sub = null;\n        }\n    };\n    Concast.prototype.cleanup = function (callback) {\n        var _this = this;\n        var called = false;\n        var once = function () {\n            if (!called) {\n                called = true;\n                _this.observers.delete(observer);\n                callback();\n            }\n        };\n        var observer = {\n            next: once,\n            error: once,\n            complete: once,\n        };\n        this.addObserver(observer);\n    };\n    return Concast;\n}(Observable));\nexport { Concast };\nif (typeof Symbol === \"function\" && Symbol.species) {\n    Object.defineProperty(Concast, Symbol.species, {\n        value: Observable,\n    });\n}\n//# sourceMappingURL=Concast.js.map"]},"metadata":{},"sourceType":"module"}